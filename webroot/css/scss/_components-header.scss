@use "theme" as *;
@use "base-utils" as *;

// 30px -> 40px
$nav-sub-pad-right: clamp(1.875rem, 6vw, 2.5rem);
// 8px -> 16px
$nav-sub-arrow-right: clamp(0.5rem, 2.5vw, 1rem);
// 16px -> 20px
$nav-sub-arrow-size: clamp(1rem, 3.5vw, 1.25rem);
// 26.25rem (420px)
$nav-dropdown-max-width: calc(42 * 0.625rem);
// -2px
$nav-dropdown-right: calc(-0.2 * 0.625rem);
// 10px
$nav-dropdown-arrow-base: 0.625rem;
// 10px / 12px
$nav-dropdown-pad-top: 0.625rem;
$nav-dropdown-pad-x: 0.75rem;
$nav-dropdown-pad-bottom: 0.75rem;
// 15px / 45px
$hdr-notice-pad-y: 0.9375rem;
$hdr-notice-pad-x: calc(4.5 * 0.625rem);
// 24px
$hdr-close-size: calc(2.4 * 0.625rem);
// -3px / 2px
$hdr-close-margin-top: calc(-0.3 * 0.625rem);
$hdr-close-margin-right: calc(0.2 * 0.625rem);
// 24px
$primary-hdr-pad: 1.5rem;
// 5px
$primary-hdr-pad-sticking: 0.3125rem;
// 120px / 90px
$logo-width-default: 7.5rem;
$logo-width-sticky: 5.625rem;
// 24px -> 44px
$layout-rail-pad-inline: clamp(1.5rem, 6.5vw, 2.75rem);
// 24px
$hdr-container-gap: 1.5rem;
// -- MAIN NAV START --
header {
  nav {
    display: inline-block;
    vertical-align: middle;
    position: relative;
    z-index: 100;

    a:link,
    a:visited {
      // font-family: var(--font-serif);
      position: relative;
      text-align: center;
      height: 100%;
    }
    a:link,
    a:visited,
    a:hover,
    a:focus,
    .current > a {
      color: var(--color-ink-on-dark);
    }

    ul {
      li {
        position: relative;
        margin: 0;

        &.has-sub > a {
          position: relative;
          padding-right: $nav-sub-pad-right;

          &::after {
            content: "";
            position: absolute;
            top: 50%;
            right: $nav-sub-arrow-right;
            width: $nav-sub-arrow-size;
            height: $nav-sub-arrow-size;
            transform: translateY(-50%) rotate(90deg);
            transition: transform 100ms ease-in-out;
            mask: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M8 6l8 6-8 6' fill='none' stroke='currentColor' stroke-width='3.2' stroke-linecap='round' stroke-linejoin='round'/></svg>");
            mask-size: cover;
            mask-repeat: no-repeat;
            mask-position: center;
            -webkit-mask: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M8 6l8 6-8 6' fill='none' stroke='currentColor' stroke-width='3.2' stroke-linecap='round' stroke-linejoin='round'/></svg>") center/cover no-repeat;
            background-color: currentColor;
          }
        }

        &.is-open > ul,
        &:focus-within > ul {
          opacity: 1;
          pointer-events: initial;
        }

        &.is-open.has-sub > a::after {
          transform: translateY(-50%) rotate(-90deg);
        }
      }
      // Drop menu   
      ul {
        display: block;
        opacity: 0;
        pointer-events: none;
        box-shadow: $boxShadowSubtle;
        position: absolute;
        width: max-content;
        max-width: $nav-dropdown-max-width;
        border-radius: var(--radius-xs);
        left: auto;
        right: $nav-dropdown-right;
        transition: opacity 250ms ease-in-out;
        padding-inline-start: 0;

        &:before {
          content: "";
          width: 0;
          height: 0;
          display: block;
          border-style: solid;
          border-width: 0 calc(1.2 * #{$nav-dropdown-arrow-base}) calc(1.2 * #{$nav-dropdown-arrow-base}) calc(1.2 * #{$nav-dropdown-arrow-base});
          border-color: transparent transparent var(--color-ink-on-dark) transparent;
          top: calc(-1.2 * #{$nav-dropdown-arrow-base});
          left: auto;
          right: calc(1.6 * #{$nav-dropdown-arrow-base});
          position: absolute;
          z-index: 1;
          filter: drop-shadow(
            0 calc(-0.2 * #{$nav-dropdown-arrow-base}) calc(0.25 * #{$nav-dropdown-arrow-base})
              rgb(var(--color-ink-absolute-rgb) / 0.1)
          );
        }

        a:link,
        a:visited {
          font-family: var(--font-sans);
          background: rgb(var(--color-surface-base-rgb) / 0.9);
          color: var(--color-ink-primary);
          font-size: var(--step--1);
          display: block;
          text-align: left;
          padding: $nav-dropdown-pad-top $nav-dropdown-pad-x $nav-dropdown-pad-bottom;
        }

        li {
          display: block;

          &:first-child a:link,
          &:first-child a:visited {
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
          }

          &:last-child a:link,
          &:last-child a:visited {
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
          }
        }
      }
    }

    .current .current a,
    ul ul a:hover {
      background: var(--color-surface-muted);
      color: var(--color-brand-primary);
    }
  }
}
// -- MAIN NAV END --
#hdr-notice {
  background: var(--color-ink-contrast);
  color: var(--color-ink-on-dark);
  text-shadow: $textShadow;
  position: relative;
  padding: $hdr-notice-pad-y $hdr-notice-pad-x;

  .hdr-notice-content {
    @include wrapperNarrow;
    font-size: var(--font-label);
    position: relative;
    text-align: center;
  }

  #close-notice {
    display: inline-block;
    vertical-align: middle;
    width: $hdr-close-size;
    height: $hdr-close-size;
    padding: 0;
    mask: url(/img/icons/circle-close.svg);
    mask-size: cover;
    background: var(--color-surface-base);
    border: none;
    appearance: none;
    cursor: pointer;
    margin: $hdr-close-margin-top $hdr-close-margin-right 0 0;
    transition: all 250ms ease-out;

    &:hover,
    &:focus {
      background: var(--color-brand-primary);
    }
  }

  .notice-btn:link,
  .notice-btn:visited {
    color: var(--color-ink-on-dark);
    font-weight: bold;
    text-decoration: underline;
    white-space: nowrap;
  }

  .notice-btn:hover,
  .notice-btn:focus {
    text-decoration: none;
  }
}


header {
  &.primary-hdr {
    background: var(--color-surface-base);
    padding-block: $primary-hdr-pad;
    position: fixed;
    inset: 0 0 auto 0;
    transition: padding-block 500ms ease-in-out;
    z-index: 100;

    a:link,
    a:visited,
    a:hover,
    a:focus,
    .current > a {
      color: var(--color-ink-primary);
    }

    &::after {
      content: "";
      position: absolute;
      inset: 0;
      // background: #fff;
      box-shadow: $boxShadow;
      z-index: -1;
      opacity: 0;
      transition: opacity 500ms ease-in-out;
    }
    & img {
      --logo-width: #{$logo-width-default};
    }
    &.sticking {
      & img {
        --logo-width: #{$logo-width-sticky};
        transition: 500ms ease-in-out;
      }
      background: rgb(var(--color-surface-base-rgb) / 0.8);
      padding-block: $primary-hdr-pad-sticking;
      backdrop-filter: blur(4px);

      &::after {
        opacity: 1;
      }
      & a:link,
      & a:visited,
      & a:hover,
      & a:focus,
      & .current > a {
        color: var(--color-ink-absolute);
      }
    }
  }
}

/* When a hero is present, allow the header to sit on dark media. */
body:has(.page-hero) {
  header.primary-hdr {
    background: transparent;
  }

  header.primary-hdr a:link,
  header.primary-hdr a:visited,
  header.primary-hdr a:hover,
  header.primary-hdr a:focus,
  header.primary-hdr .current > a {
    color: var(--color-ink-on-dark);
  }
}

.layout-rail {
  @include container-inline("directory-max");
  padding-inline: $layout-rail-pad-inline;

  & + & {
    margin-top: var(--space-xl);
  }
}

.hdr-container {
  @include wrapperMedium;
  display: flex;
  align-items: center;
  gap: $hdr-container-gap;
}

.hdr-links {
  margin-right: calc(-0.5 * var(--inline-padding));
}

.logo {
  margin: 0 auto 0 0;

  img {
    width: var(--logo-width);
  }
}
:root{ --drift: 6px; --dur: 2.4s; --tilt: 5deg; }